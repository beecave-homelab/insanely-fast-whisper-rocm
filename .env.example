# Insanely Fast Whisper API - Environment Configuration
# Copy this file to `.env` and adjust any values you need.
# All variables are optional – sensible defaults are applied in code.

#------------------------------------------------------------------------------
# Model Configuration (affect CLI / API / WebUI defaults)
#------------------------------------------------------------------------------

# Hugging-Face model to use for transcription / translation
WHISPER_MODEL=distil-whisper/distil-large-v3

# Device ID: "0", "1", … for CUDA; "mps" for Apple Silicon; "cpu" for CPU
WHISPER_DEVICE=0

# Batch size (1-32). Larger = faster but more GPU memory.
WHISPER_BATCH_SIZE=4

# Progress granularity: number of chunks submitted per pipeline call for UI updates.
# Higher values reduce progress update frequency (potentially slightly faster),
# lower values increase responsiveness. Independent of model batch size.
PROGRESS_GROUP_SIZE=4

# Timestamp granularity: chunk | word
WHISPER_TIMESTAMP_TYPE=chunk

# Language code (e.g. en, fr) or None to auto-detect
WHISPER_LANGUAGE=None

# Inference dtype: float16 | float32 | bfloat16
WHISPER_DTYPE=float16

# Use BetterTransformer acceleration (true | false)
WHISPER_BETTER_TRANSFORMER=false

# Maximum audio length (seconds) processed per chunk
WHISPER_CHUNK_LENGTH=30

#------------------------------------------------------------------------------
# Timestamp Stabilization Defaults  (affect CLI / API / WebUI defaults)
#------------------------------------------------------------------------------

# Enable word-level stabilization by default
STABILIZE_DEFAULT=false

# Run Demucs source-separation before stabilization
DEMUCS_DEFAULT=false

# Run Voice Activity Detection (VAD) before stabilization
VAD_DEFAULT=false

# Default VAD threshold (0-1); lower = more aggressive speech detection
VAD_THRESHOLD_DEFAULT=0.35

#------------------------------------------------------------------------------
# Diarization Configuration (needed for some diarization models)
#------------------------------------------------------------------------------

WHISPER_DIARIZATION_MODEL=pyannote/speaker-diarization
# HF_TOKEN=your_huggingface_token_here

#------------------------------------------------------------------------------
# File Handling
#------------------------------------------------------------------------------

WHISPER_UPLOAD_DIR=temp_uploads
WHISPER_TRANSCRIPTS_DIR=transcripts

# Application timezone (affects filenames / logs)
TZ=Europe/Amsterdam

#------------------------------------------------------------------------------
# Audio Chunking Configuration
#------------------------------------------------------------------------------

AUDIO_CHUNK_DURATION=600        # seconds
AUDIO_CHUNK_OVERLAP=1.0         # seconds
AUDIO_CHUNK_MIN_DURATION=5.0    # seconds

#------------------------------------------------------------------------------
# ROCm / HIP (AMD GPU) Configuration
#------------------------------------------------------------------------------

# Avoid forcing unsupported HIP allocator modes on some ROCm stacks
# PYTORCH_HIP_ALLOC_CONF=expandable_segments:False
HSA_OVERRIDE_GFX_VERSION=10.3.0
# HIP_LAUNCH_BLOCKING=1

# Torchaudio backend selection (when using stable-ts lambda path)
# Set to 1 if you have libsndfile + soundfile installed in the environment
# to enable saving WAV files via torchaudio.save().
# TORCHAUDIO_USE_SOUNDFILE=1

#------------------------------------------------------------------------------
# Additional Configuration
#------------------------------------------------------------------------------

SAVE_TRANSCRIPTIONS=true

# API bind address and port (used when not overridden by CLI flags)
API_HOST=0.0.0.0
API_PORT=8888
# WebUI bind address and port (used when not overridden by CLI flags)
WEBUI_HOST=0.0.0.0
WEBUI_PORT=7860

# Logging level: DEBUG | INFO | WARNING | ERROR
LOG_LEVEL=INFO

#------------------------------------------------------------------------------
# Subtitle Readability & Segmentation (SRT/VTT)

# Master switch for the new segmentation pipeline (true | false)
USE_READABLE_SUBTITLES=true


# Maximum characters per line for subtitle text (hard wrap limit per line)
MAX_LINE_CHARS=42

# Maximum number of lines per subtitle block (usually 2)
MAX_LINES_PER_BLOCK=2

# Hard limit for total characters in a block (e.g. 2 * MAX_LINE_CHARS)
MAX_BLOCK_CHARS=84

# Soft limit for total characters in a block (slightly above hard limit)
MAX_BLOCK_CHARS_SOFT=90

# Reading speed limits: characters per second (CPS)
MIN_CPS=12.0
MAX_CPS=17.0

# Segment duration bounds in seconds
MIN_SEGMENT_DURATION_SEC=1.2
MAX_SEGMENT_DURATION_SEC=5.5

# Display buffer (in seconds) that can be used by formatters/pipelines
DISPLAY_BUFFER_SEC=0.2

# Clause splitting/merging heuristics (comma-separated lists)
# Words suggesting soft clause boundaries (language-dependent)
SOFT_BOUNDARY_WORDS=and,but,or,so,for,nor,yet

# Interjections that may be preserved/handled specially
INTERJECTION_WHITELIST=um,uh,ah,er,like